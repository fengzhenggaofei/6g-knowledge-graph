<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6G 业务-指标-技术 三位一体建模图谱</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; color: #f8fafc; overflow: hidden; }
        .node { stroke-width: 2px; cursor: grab; transition: stroke-width 0.2s ease, r 0.2s ease; }
        .node:active { cursor: grabbing; }
        .node:hover { filter: drop-shadow(0 0 12px rgba(96, 165, 250, 0.6)); r: 18; }
        
        /* 基础连线 */
        .link { 
            stroke-opacity: 0.3; 
            stroke-dasharray: 4, 4; 
            transition: stroke-opacity 0.4s ease;
            pointer-events: none;
        }
        
        /* 交互高亮 */
        .link.active {
            stroke-dasharray: 0;
            stroke-opacity: 0.9;
            stroke-width: 3px;
        }
        
        .label { 
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; 
            font-size: 11px; 
            pointer-events: none; 
            fill: #94a3b8; 
            transition: opacity 0.3s ease;
        }
        
        #tooltip {
            position: absolute;
            display: none;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #1e293b;
            padding: 16px;
            border-radius: 12px;
            max-width: 320px;
            backdrop-filter: blur(8px);
            z-index: 100;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .layer-bg { fill: rgba(30, 41, 59, 0.15); stroke: rgba(51, 65, 85, 0.3); stroke-dasharray: 8, 4; }
        
        .layer-label { 
            font-size: 18px; 
            font-weight: 900; 
            fill: rgba(226, 232, 240, 0.7); 
            text-transform: uppercase; 
            letter-spacing: 0.3em;
            pointer-events: none;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }
        
        .ai-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .ai-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            border: 1px solid rgba(56, 189, 248, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>

    <!-- UI Overlay (Fixed) -->
    <div class="absolute top-0 left-0 p-8 z-10 pointer-events-none">
        <h1 class="text-3xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-br from-white to-slate-500 pointer-events-auto">
            6G 价值链建模 <span class="text-sm font-normal text-blue-400 ml-2 tracking-normal italic">Expert Mode</span>
        </h1>
        <p class="mt-2 text-xs text-slate-500 uppercase tracking-widest pointer-events-auto flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-blue-500 ai-pulse"></span>
            Dynamic Topological Manipulation Enabled
        </p>
    </div>

    <!-- AI Panel -->
    <div class="absolute bottom-8 left-8 z-20 w-80 pointer-events-auto">
        <div class="ai-card p-5 rounded-2xl backdrop-blur-xl">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Gemini 专家引擎
                </h3>
                <span id="indicator" class="text-[9px] px-2 py-0.5 rounded-full bg-slate-800 text-slate-400 border border-slate-700 uppercase">Idling</span>
            </div>
            
            <div id="ai-viewport" class="space-y-3 min-h-[100px] max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                <p id="ai-placeholder" class="text-xs text-slate-500 italic leading-relaxed">
                    您可以自由拖拽节点以优化布局。点击节点后，Gemini 将为您深度解析其系统逻辑。
                </p>
                <div id="ai-response-area" class="text-xs text-slate-200 leading-relaxed hidden"></div>
            </div>

            <div id="ai-actions" class="mt-4 pt-4 border-t border-slate-800/50 flex flex-col gap-2 hidden">
                <button id="btn-path-insight" class="w-full bg-blue-600 hover:bg-blue-500 text-white text-[10px] py-2.5 rounded-lg font-bold transition-all shadow-lg shadow-blue-900/40">
                    ✨ 执行全链路智能推演
                </button>
            </div>
        </div>
    </div>

    <div id="tooltip"></div>
    <div id="graph-container" class="w-full h-screen"></div>

    <script>
        const apiKey = ""; 

        const data = {
            nodes: [
                { id: "全息通信", layer: 1, group: "case", desc: "极致沉浸式体验，支持三维全息影像的实时传输与交互。" },
                { id: "触觉互联网", group: "case", layer: 1, desc: "实现力觉、痛觉、热觉的毫秒级远程闭环传输。" },
                { id: "沉浸式云XR", group: "case", layer: 1, desc: "将计算完全卸载至云端，实现轻量化无线VR/AR。" },
                { id: "自动驾驶(L5)", group: "case", layer: 1, desc: "全环境感知与群体协同决策，消除驾驶员干扰。" },
                { id: "空天地覆盖", group: "case", layer: 1, desc: "为海洋、深空、偏远地区提供无缝高速接入。" },
                { id: "峰值速率(1Tbps)", group: "req", layer: 2, desc: "支持单用户超大规模数据流。" },
                { id: "超低时延(0.1ms)", group: "req", layer: 2, desc: "满足工业控制与同步实时反馈。" },
                { id: "连接密度(10^8/km²)", group: "req", layer: 2, desc: "支撑万物互联，包含海量传感器。" },
                { id: "感知精度(cm级)", group: "req", layer: 2, desc: "结合无线波束实现环境高精度绘图。" },
                { id: "可靠性(99.99999%)", group: "req", layer: 2, desc: "关键任务的极高健壮性保障。" },
                { id: "太赫兹通信(THz)", group: "tech", layer: 3, desc: "利用0.1THz-10THz频段获取极大带宽。" },
                { id: "AI原生空中接口", group: "tech", layer: 3, desc: "深度神经网络优化信号编解码，实现自适应空口。" },
                { id: "算力网络编排", group: "tech", layer: 3, desc: "实现云网边端资源的动态协同与任务分发。" },
                { id: "语义通信架构", group: "tech", layer: 3, desc: "跳过比特层，直接在语义/知识层进行交互。" },
                { id: "RIS 智能表面", group: "tech", layer: 3, desc: "利用超材料改变无线信道的被动属性。" },
                { id: "分布式自治网络", group: "tech", layer: 3, desc: "去中心化的网络治理与智能编排。" }
            ],
            links: [
                { source: "全息通信", target: "峰值速率(1Tbps)" },
                { source: "全息通信", target: "超低时延(0.1ms)" },
                { source: "触觉互联网", target: "超低时延(0.1ms)" },
                { source: "触觉互联网", target: "可靠性(99.99999%)" },
                { source: "自动驾驶(L5)", target: "感知精度(cm级)" },
                { source: "自动驾驶(L5)", target: "可靠性(99.99999%)" },
                { source: "沉浸式云XR", target: "峰值速率(1Tbps)" },
                { source: "空天地覆盖", target: "连接密度(10^8/km²)" },
                { source: "峰值速率(1Tbps)", target: "太赫兹通信(THz)" },
                { source: "峰值速率(1Tbps)", target: "语义通信架构" },
                { source: "超低时延(0.1ms)", target: "算力网络编排" },
                { source: "超低时延(0.1ms)", target: "AI原生空中接口" },
                { source: "连接密度(10^8/km²)", target: "分布式自治网络" },
                { source: "感知精度(cm级)", target: "太赫兹通信(THz)" },
                { source: "感知精度(cm级)", target: "RIS 智能表面" },
                { source: "可靠性(99.99999%)", target: "AI原生空中接口" }
            ]
        };

        const width = window.innerWidth;
        const height = window.innerHeight;
        const colors = { case: "#6366f1", req: "#10b981", tech: "#f59e0b" };

        const svg = d3.select("#graph-container").append("svg")
            .attr("width", width).attr("height", height);

        // 绘制背景层
        const layers_names = ["用例层", "指标层", "技术层"];
        layers_names.forEach((l, i) => {
            svg.append("rect")
                .attr("class", "layer-bg")
                .attr("x", 40).attr("y", (height / 3) * i + 10)
                .attr("width", width - 80).attr("height", (height / 3) - 20).attr("rx", 24);
            
            svg.append("text")
                .attr("class", "layer-label")
                .attr("x", width - 60).attr("y", (height / 3) * i + (height / 6))
                .attr("text-anchor", "end").attr("dominant-baseline", "middle")
                .text(l);
        });

        const container = svg.append("g");

        // 初始化力导向系统
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(180))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("x", d3.forceX(width * 0.4).strength(0.15))
            .force("y", d3.forceY(d => (height / 3) * (d.layer - 1) + (height / 6)).strength(2.0))
            .force("collision", d3.forceCollide().radius(70));

        // 连线
        const link = container.append("g")
            .selectAll("line").data(data.links).join("line")
            .attr("class", "link").attr("stroke", "#1e293b").attr("stroke-width", 1.5);

        // 拖拽逻辑实现
        const drag = d3.drag()
            .on("start", (event, d) => {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
                d3.select(event.sourceEvent.target).attr("cursor", "grabbing");
            })
            .on("drag", (event, d) => {
                d.fx = event.x;
                d.fy = event.y;
            })
            .on("end", (event, d) => {
                if (!event.active) simulation.alphaTarget(0);
                // 释放锁定可以让节点回到力场平衡位，或者保持锁定让用户自定义布局
                // 这里选择不释放锁定(保持 fx, fy)，让用户可以“摆放”图谱
                d3.select(event.sourceEvent.target).attr("cursor", "grab");
            });

        // 节点
        const node = container.append("g")
            .selectAll("circle").data(data.nodes).join("circle")
            .attr("class", "node").attr("r", 15)
            .attr("fill", d => colors[d.group])
            .call(drag) // 绑定拖拽
            .on("click", (e, d) => selectNode(d))
            .on("mouseover", showTooltip).on("mouseout", hideTooltip);

        // 标签
        const label = container.append("g")
            .selectAll("text").data(data.nodes).join("text")
            .attr("class", "label").attr("text-anchor", "middle").attr("dy", 30)
            .text(d => d.id);

        simulation.on("tick", () => {
            link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            node.attr("cx", d => d.x).attr("cy", d => d.y);
            label.attr("x", d => d.x).attr("y", d => d.y);
        });

        // 交互功能
        let selectedNode = null;
        function selectNode(d) {
            selectedNode = d;
            highlightConnections(d);
            document.getElementById('ai-placeholder').classList.add('hidden');
            const responseArea = document.getElementById('ai-response-area');
            responseArea.classList.remove('hidden');
            responseArea.innerHTML = `
                <div class="p-3 rounded-lg bg-blue-500/10 border border-blue-500/20 mb-3">
                    <span class="text-blue-400 font-bold">选中节点:</span> ${d.id}
                </div>
                <p class="text-slate-400">系统拓扑已锁定。您可以继续拖动其他节点，或点击下方按钮执行深度分析。</p>
            `;
            document.getElementById('ai-actions').classList.remove('hidden');
        }

        function highlightConnections(d) {
            const connectedLinks = data.links.filter(l => l.source.id === d.id || l.target.id === d.id);
            const connectedNodeIds = new Set(connectedLinks.flatMap(l => [l.source.id, l.target.id]));
            node.style("opacity", n => connectedNodeIds.has(n.id) || n.id === d.id ? 1 : 0.1);
            link.attr("class", l => (l.source.id === d.id || l.target.id === d.id) ? "link active" : "link")
                .style("stroke", l => (l.source.id === d.id || l.target.id === d.id) ? colors[d.group] : "#1e293b");
        }

        const tooltip = d3.select("#tooltip");
        function showTooltip(event, d) {
            tooltip.style("display", "block").html(`
                <div class="text-white font-bold text-base mb-1">${d.id}</div>
                <div class="text-xs text-slate-400 leading-snug">${d.desc}</div>
                <div class="mt-2 text-[10px] text-blue-500 italic">按住左键可自由拖动</div>
            `);
            tooltip.style("left", `${event.pageX + 15}px`).style("top", `${event.pageY - 15}px`);
        }
        function hideTooltip() { tooltip.style("display", "none"); }

        // AI 接口调用
        document.getElementById('btn-path-insight').addEventListener('click', async () => {
            if (!selectedNode) return;
            const indicator = document.getElementById('indicator');
            const responseArea = document.getElementById('ai-response-area');
            indicator.innerText = "Analyzing...";
            indicator.classList.add('ai-pulse');
            
            try {
                const prompt = `专家节点: ${selectedNode.id}。请从系统思考角度，分析其在6G架构中的核心地位及技术约束。`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "你是一位 6G 与 AI 专家。请给出深刻且具有第一性原理视角的专业见解，字数约 150 字。" }] }
                    })
                });
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "解析失败。";
                responseArea.innerHTML = `<div class="prose prose-invert prose-xs animate-in slide-in-from-top-1">${text.replace(/\n/g, '<br>')}</div>`;
                indicator.innerText = "Analyzed";
            } catch (e) {
                responseArea.innerText = "AI 引擎连接异常。";
                indicator.innerText = "Error";
            } finally {
                indicator.classList.remove('ai-pulse');
            }
        });

        window.addEventListener('resize', () => { location.reload(); });
    </script>
</body>
</html>
