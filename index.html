<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6G 场景-诉求-能力-技术 四层建模图谱</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; color: #f8fafc; overflow: hidden; }
        .node { stroke-width: 2px; cursor: grab; transition: stroke-width 0.2s ease, r 0.2s ease; }
        .node:active { cursor: grabbing; }
        .node:hover { filter: drop-shadow(0 0 12px rgba(96, 165, 250, 0.6)); r: 16; }
        
        .link { 
            stroke-opacity: 0.15; 
            stroke-dasharray: 3, 3; 
            transition: stroke-opacity 0.4s ease;
            pointer-events: none;
        }
        
        .link.active {
            stroke-dasharray: 0;
            stroke-opacity: 0.8;
            stroke-width: 2px;
        }
        
        .label { 
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; 
            font-size: 10px; 
            pointer-events: none; 
            fill: #94a3b8; 
        }
        
        #tooltip {
            position: absolute;
            display: none;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #1e293b;
            padding: 14px;
            border-radius: 12px;
            max-width: 300px;
            backdrop-filter: blur(10px);
            z-index: 100;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.7);
        }
        
        .layer-bg { fill: rgba(30, 41, 59, 0.12); stroke: rgba(51, 65, 85, 0.2); stroke-dasharray: 6, 3; }
        
        .layer-label { 
            font-size: 13px; 
            font-weight: 800; 
            fill: rgba(148, 163, 184, 0.4); 
            text-transform: uppercase; 
            letter-spacing: 0.15em;
            pointer-events: none;
        }
        
        .ai-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 3px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .ai-card {
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.85) 100%);
            border: 1px solid rgba(56, 189, 248, 0.15);
        }
    </style>
</head>
<body>

    <!-- 顶部标题栏 -->
    <div class="absolute top-0 left-0 p-8 z-10 pointer-events-none">
        <h1 class="text-2xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-br from-white to-slate-500 pointer-events-auto">
            6G 系统架构智能演进图谱
        </h1>
        <p class="mt-1 text-[10px] text-slate-500 uppercase tracking-widest pointer-events-auto flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-blue-500 ai-pulse"></span>
            System-Level Cognitive Mapping
        </p>
    </div>

    <!-- 侧边 AI 分析面板 -->
    <div class="absolute bottom-8 left-8 z-20 w-80 pointer-events-auto">
        <div class="ai-card p-5 rounded-2xl backdrop-blur-xl">
            <div class="flex justify-between items-start mb-3">
                <h3 class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">GEMINI 专家引擎</h3>
                <span id="indicator" class="text-[8px] px-2 py-0.5 rounded-full bg-slate-800 text-slate-500 border border-slate-700 uppercase">Analysis Ready</span>
            </div>
            
            <div id="ai-viewport" class="space-y-3 min-h-[80px] max-h-52 overflow-y-auto pr-2 custom-scrollbar">
                <p id="ai-placeholder" class="text-[11px] text-slate-500 italic leading-relaxed">
                    链路已根据“网元智能解决方案生成”的完整组件诉求完成更新。请选择节点以查看其全链路映射。
                </p>
                <div id="ai-response-area" class="text-[11px] text-slate-200 leading-relaxed hidden"></div>
            </div>

            <div id="ai-actions" class="mt-4 pt-4 border-t border-slate-800/50 flex flex-col gap-2 hidden">
                <button id="btn-path-insight" class="w-full bg-blue-700 hover:bg-blue-600 text-white text-[10px] py-2 rounded-lg font-bold transition-all shadow-lg shadow-blue-900/20">
                    ✨ 执行全链路智能推演
                </button>
            </div>
        </div>
    </div>

    <div id="tooltip"></div>
    <div id="graph-container" class="w-full h-screen"></div>

    <script>
        /**
         * ==========================================
         * 核心知识库 (KNOWLEDGE_BASE)
         * 您可以在此处独立编辑所有的节点与链路逻辑
         * ==========================================
         */
        const KNOWLEDGE_BASE = {
            // 节点定义
            nodes: [
                // Layer 1: 场景层 (Scenarios)
                { id: "体验保障", layer: 1, group: "S", desc: "深度识别UE的报文的业务类型，基站根据业务类型做相关的体验保障。" },
                { id: "智能节能", layer: 1, group: "S", desc: "降低节能保障的人工干预程度，在保障覆盖和用户体验前提下，提升节能效率。" },
                { id: "移动性寻优", layer: 1, group: "S", desc: "在UE启动过程中，迁移UE到合适的频层，制式，邻区，提升UE的体验，提升小区级吞吐率。" },
                { id: "CA分流", layer: 1, group: "S", desc: "动态调整UE在多个载波间动态分流因子，提升小区的下行吞吐率。" },
                { id: "通感一体化", layer: 1, group: "S", desc: "感知目标识别，提升目标对象识别准确率提升95%；多模感知融合降低感知虚警率到1%。" },
                { id: "智能运维", layer: 1, group: "S", desc: "智能根因分析，异常根因识别定界定位。" },
                { id: "谱效提升", layer: 1, group: "S", desc: "下行谱效提升5%，小区吞吐率提升20%，上行UE流量提升10%。" },
                { id: "网元智能解决方案生成", layer: 1, group: "S", desc: "人工运维工时减少90%，新服务上市时间缩短50%。" },
                
                // Layer 2: 业务诉求层 (Requirements)
                { id: "体验保障推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构 LSTM, 参数规模30K, 推理时延<10ms, 推理并发度(80Hz)" },
                { id: "体验保障数据量诉求", layer: 2, group: "R", desc: "指标要求：数据量10G, 每秒20000包, 每包小于200Byte" },
                { id: "智能节能推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构LSTM/Delinear、参数规模200K、推理时延 50ms、推理并发度(60s一次)" },
                { id: "移动性寻优推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构LSTM、参数规模1M、推理时延8ms、推理并发度(100)" },
                { id: "移动性寻优训练诉求", layer: 2, group: "R", desc: "指标要求：训练时延 30min 、训练并发度(1）" },
                { id: "移动性寻优优先级策略诉求", layer: 2, group: "R", desc: "指标要求：优先级策略 推理最高； 支持20个优先级" },
                { id: "CA分流推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构FCNN、参数规模3K、推理时延<5ms、GPU推理并发度(400/s)" },
                { id: "通感一体化推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构LSTM,MLP,Yolo、参数规模.34M、推理时延<640ms、推理并发度640ms" },
                { id: "通感一体化数据量诉求", layer: 2, group: "R", desc: "指标要求：2Gbps" },
                { id: "智能运维推理诉求", layer: 2, group: "R", desc: "指标要求：LSTM、lightGBM，参数规模 1M，时延小于100ms， 10次每秒" },
                { id: "谱效提升推理诉求", layer: 2, group: "R", desc: "指标要求：5层transformer网络；参数规模1M，时延小于100m；100次每秒" },
                { id: "网元智能解决方案生成推理诉求", layer: 2, group: "R", desc: "指标要求：各模型结构、参数规模、时延要求、推理频次（100token/s）QW3-4B-8bit； 单并发" },
                { id: "网元智能解决方案生成模型诉求", layer: 2, group: "R", desc: "指标要求：stella-large-zh, BGE-large-zh" },
                { id: "网元智能解决方案生成AI网关诉求", layer: 2, group: "R", desc: "指标要求：提供模型聚合、分发与鉴权能力。" },
                { id: "网元智能解决方案生成Agent诉求", layer: 2, group: "R", desc: "指标要求：自主规划、任务拆解与闭环控制能力。" },
                { id: "网元智能解决方案生成安全隔离诉求", layer: 2, group: "R", desc: "指标要求：多租户环境下的模型与隐私数据物理/逻辑隔离。" },
                { id: "网元智能解决方案生成图数据库诉求", layer: 2, group: "R", desc: "指标要求：存储网络拓扑、资源关系及专家知识图谱。" },
                
                // Layer 3: 平台能力层 (Capabilities)
                { id: "内生智能架构", layer: 3, group: "C", desc: "AI能力沉淀至协议栈深处，作为计算与通信协同的逻辑底座。" },
                { id: "通感融合空口", layer: 3, group: "C", desc: "统一波形设计，在单一无线帧中实现能量共享，兼顾信息传递与空间扫描。" },
                { id: "大规模编排能力", layer: 3, group: "C", desc: "支持全球范围内的毫秒级资源发现、编排与逻辑路径切片。" },
                { id: "全量数字孪生", layer: 3, group: "C", desc: "对全网基站、终端及无线信道环境进行1:1实时建模。" },
                
                // Layer 4: 平台技术层 (Technologies)
                { id: "Transformer原生空口", layer: 4, group: "T", desc: "采用自注意力机制重构物理层，极大提升非线性信道估计能力。" },
                { id: "ISAC波形设计", layer: 4, group: "T", desc: "通信感知一体化波形，平衡探测分辨率与传输速率。" },
                { id: "分布式联邦学习", layer: 4, group: "T", desc: "在保障数据隐私的前提下，实现跨地域、跨运营商的全局智能模型演进。" },
                { id: "可编程算力网元", layer: 4, group: "T", desc: "异构计算转发节点，支持网络功能逻辑的软硬件解耦与按需定制。" }
            ],
            // 链路定义 - 已合并最新的补充链路
            links: [
                { source: "体验保障", target: "体验保障推理诉求" },
                { source: "体验保障", target: "体验保障数据量诉求" },
                { source: "智能节能", target: "智能节能推理诉求" },
                { source: "移动性寻优", target: "移动性寻优推理诉求" },
                { source: "移动性寻优", target: "移动性寻优训练诉求" },
                { source: "移动性寻优", target: "移动性寻优优先级策略诉求" },
                { source: "CA分流", target: "CA分流推理诉求" },
                { source: "通感一体化", target: "通感一体化推理诉求" },
                { source: "通感一体化", target: "通感一体化数据量诉求" },
                { source: "智能运维", target: "智能运维推理诉求" },
                { source: "谱效提升", target: "谱效提升推理诉求" },
                
                // 网元智能解决方案生成的全链路补充
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成推理诉求" },
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成模型诉求" },
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成AI网关诉求" },
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成Agent诉求" },
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成安全隔离诉求" },
                { source: "网元智能解决方案生成", target: "网元智能解决方案生成图数据库诉求" },
                
                { source: "体验保障推理诉求", target: "内生智能架构" },
                { source: "通感一体化推理诉求", target: "通感融合空口" },
                { source: "智能运维推理诉求", target: "大规模编排能力" },
                { source: "谱效提升推理诉求", target: "全量数字孪生" },
                { source: "网元智能解决方案生成Agent诉求", target: "大规模编排能力" },
                
                { source: "内生智能架构", target: "Transformer原生空口" },
                { source: "通感融合空口", target: "ISAC波形设计" },
                { source: "大规模编排能力", target: "分布式联邦学习" },
                { source: "全量数字孪生", target: "可编程算力网元" }
            ]
        };

        /**
         * ==========================================
         * 图谱引擎渲染逻辑 (RENDER ENGINE)
         * ==========================================
         */
        const apiKey = ""; 
        const width = window.innerWidth;
        const height = window.innerHeight;
        const colors = { S: "#818cf8", R: "#34d399", C: "#fbbf24", T: "#f87171" };

        const svg = d3.select("#graph-container").append("svg")
            .attr("width", width).attr("height", height);

        // 绘制背景层
        const layers_names = ["场景层", "业务诉求层", "平台能力层", "平台技术层"];
        layers_names.forEach((l, i) => {
            const h = height / 4;
            svg.append("rect")
                .attr("class", "layer-bg")
                .attr("x", 40).attr("y", h * i + 10)
                .attr("width", width - 80).attr("height", h - 20).attr("rx", 16);
            
            svg.append("text")
                .attr("class", "layer-label")
                .attr("x", width - 60).attr("y", h * i + (h / 2))
                .attr("text-anchor", "end").attr("dominant-baseline", "middle")
                .text(l);
        });

        const container = svg.append("g");

        // 初始化仿真器 - 针对多诉求节点优化了斥力
        const simulation = d3.forceSimulation(JSON.parse(JSON.stringify(KNOWLEDGE_BASE.nodes)))
            .force("link", d3.forceLink(JSON.parse(JSON.stringify(KNOWLEDGE_BASE.links))).id(d => d.id).distance(90))
            .force("charge", d3.forceManyBody().strength(-350))
            .force("x", d3.forceX(width * 0.42).strength(0.08))
            .force("y", d3.forceY(d => (height / 4) * (d.layer - 1) + (height / 8)).strength(2.2))
            .force("collision", d3.forceCollide().radius(45));

        const link = container.append("g")
            .selectAll("line").data(simulation.force("link").links()).join("line")
            .attr("class", "link").attr("stroke", "#1e293b").attr("stroke-width", 1);

        const drag = d3.drag()
            .on("start", (event, d) => {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x; d.fy = d.y;
            })
            .on("drag", (event, d) => { d.fx = event.x; d.fy = event.y; })
            .on("end", (event, d) => { if (!event.active) simulation.alphaTarget(0); });

        const node = container.append("g")
            .selectAll("circle").data(simulation.nodes()).join("circle")
            .attr("class", "node").attr("r", 9)
            .attr("fill", d => colors[d.group])
            .call(drag)
            .on("click", (e, d) => selectNode(d))
            .on("mouseover", showTooltip).on("mouseout", hideTooltip);

        const label = container.append("g")
            .selectAll("text").data(simulation.nodes()).join("text")
            .attr("class", "label").attr("text-anchor", "middle").attr("dy", 20)
            .text(d => d.id.length > 8 ? d.id.substring(0,8) + "..." : d.id);

        simulation.on("tick", () => {
            link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            node.attr("cx", d => d.x).attr("cy", d => d.y);
            label.attr("x", d => d.x).attr("y", d => d.y);
        });

        function selectNode(d) {
            const currentLinks = simulation.force("link").links();
            const connectedLinks = currentLinks.filter(l => l.source.id === d.id || l.target.id === d.id);
            const connectedNodeIds = new Set(connectedLinks.flatMap(l => [l.source.id, l.target.id]));
            
            node.style("opacity", n => connectedNodeIds.has(n.id) || n.id === d.id ? 1 : 0.08);
            link.attr("class", l => (l.source.id === d.id || l.target.id === d.id) ? "link active" : "link")
                .style("stroke", l => (l.source.id === d.id || l.target.id === d.id) ? colors[d.group] : "#1e293b");
            
            document.getElementById('ai-placeholder').classList.add('hidden');
            const responseArea = document.getElementById('ai-response-area');
            responseArea.classList.remove('hidden');
            responseArea.innerHTML = `
                <div class="p-3 rounded-xl bg-blue-500/10 border border-blue-500/20 mb-3">
                    <span class="text-blue-400 font-bold">已选节点:</span> <span class="text-white ml-2 text-[12px]">${d.id}</span>
                </div>
                <p class="text-slate-200 px-1 text-[11px] font-medium leading-relaxed">${d.desc}</p>
            `;
            document.getElementById('ai-actions').classList.remove('hidden');
            window.selectedNodeData = d;
        }

        const tooltip = d3.select("#tooltip");
        function showTooltip(event, d) {
            tooltip.style("display", "block").html(`
                <div class="text-white font-bold text-sm mb-1">${d.id}</div>
                <div class="text-[10px] text-slate-400 leading-normal">${d.desc}</div>
            `);
            tooltip.style("left", `${event.pageX + 15}px`).style("top", `${event.pageY - 15}px`);
        }
        function hideTooltip() { tooltip.style("display", "none"); }

        document.getElementById('btn-path-insight').addEventListener('click', async () => {
            const nodeData = window.selectedNodeData;
            if (!nodeData) return;
            const indicator = document.getElementById('indicator');
            const responseArea = document.getElementById('ai-response-area');
            indicator.innerText = "Analyzing System...";
            indicator.classList.add('ai-pulse');
            
            try {
                const prompt = `你是一个 6G 架构专家。请针对节点 "${nodeData.id}"，分析该核心诉求在智能网元架构中的战略意义，以及它如何通过 AI 能力底座提升系统闭环效率。约 180 字，Markdown 格式。`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "你是一位资深 6G 专家，擅长从系统工程和第一性原理角度分析业务指标与架构组件的逻辑关系。" }] }
                    })
                });
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "分析生成失败。";
                responseArea.innerHTML = `<div class="prose prose-invert prose-xs text-[10px] mt-2">${text.replace(/\n/g, '<br>')}</div>`;
                indicator.innerText = "Completed";
            } catch (e) {
                responseArea.innerText = "专家引擎连接失败。";
                indicator.innerText = "Error";
            } finally {
                indicator.classList.remove('ai-pulse');
            }
        });

        window.addEventListener('resize', () => { location.reload(); });
    </script>
</body>
</html>
